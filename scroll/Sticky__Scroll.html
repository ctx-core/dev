<:Window
  on:scroll="reset(event)"
  on:resize="reset(event)"
/>

<div ref:el class="Sticky__Scroll">
  {{yield}}
</div>

<script type="buble">
  import {log,debug} from 'ctx-core/logger/lib'
  const logPrefix = 'ctx-core/sticky__scroll__header/Sticky__Scroll.html'
  export default {
    oncreate,
    ondestroy,
    methods: {
      reset
    }
  }
  function oncreate() {
    log(`${logPrefix}|oncreate`)
    reset.call(this)
  }
  function ondestroy() {
    log(`${logPrefix}|ondestroy`)
    const C = this
        , {el} = C.refs
    if (contains__viewport(el)) {
      remove__viewport(C, el)
    }
    if (contains__active(el)) {
      remove__active(C, el)
    }
  }
  function reset() {
    const C = this
        , {el} = C.refs
        , {top, bottom} = el.getBoundingClientRect()
        , {innerHeight} = window
        , active = top <= 0 && bottom >= 0
        , viewport =
            (top > 0 && top < innerHeight)
            || active
    if (viewport) {
      if (!contains__viewport(el)) {
        add__viewport(C, el)
      }
    } else {
      if (contains__viewport(el)) {
        remove__viewport(C, el)
      }
    }
    if (active) {
      if (!contains__active(el)) {
        add__active(C, el)
      }
    } else {
      if (contains__active(el)) {
        remove__active(C, el)
      }
    }
  }
  function contains__viewport(el) {
    return el.classList.contains('viewport')
  }
  function contains__active(el) {
    return el.classList.contains('active')
  }
  function add__viewport(C, el) {
    el.classList.add('viewport')
    C.fire('add__viewport', {el})
  }
  function remove__viewport(C, el) {
    el.classList.remove('viewport')
    C.fire('remove__viewport', {el})
  }
  function add__active(C, el) {
    el.classList.add('active')
    C.fire('add__active', {el})
  }
  function remove__active(C, el) {
    el.classList.remove('active')
    C.fire('remove__active', {el})
  }
</script>