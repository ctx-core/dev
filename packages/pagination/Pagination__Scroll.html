<script>
	import { get, writable } from 'svelte/store'
	import { _class } from '@ctx-core/html'
	import { __click__ripple_effect } from '@ctx-core/ripple-effect'
	import { __click__anchor__scroll } from '@ctx-core/dom'
	import { log, debug } from '@ctx-core/logger'
	const logPrefix = '@ctx-core/pagination/Pagination__Scroll.html'
	export let prev__section = null
	export let next__section = null
	export let sections = []
	export let color__ripple = null
	let link__prev__section, link__next__section
	const sections__ = writable(sections)
	sections__.subscribe($sections => {
		log(`${logPrefix}|sections|subscribe`)
		update__navigation__section()
	})
	const __loaded__prev__section = writable()
	const __loaded__next__section = writable()
	const class__root = $$props.class
	update__navigation__section()
	function update__navigation__section() {
		unset__loaded()
		const $sections__ = get(sections__)
		if ($sections__) {
			for (let i = 0; i < $sections__.length; i++) {
				const section = $sections__[i]
				const BoundingClientRect = section.getBoundingClientRect()
				const { top } = BoundingClientRect
				const bottom = BoundingClientRect.bottom - 10
				if (bottom >= 0) {
					prev__section =
						top < 0
						? section
						: $sections__[i - 1]
					next__section = sections[i + 1]
					set__loaded()
					return
				}
			}
		}
		prev__section = null
		next__section = null
	}
	function __click__navigation(event) {
		__click__anchor__scroll(event)
		const $sections__ = get(sections__)
		if ($sections__) {
			if (color__ripple) __click__ripple_effect(event)
			update__navigation__section()
		}
	}
	function unset__loaded() {
		__loaded__prev__section.set(false)
		__loaded__next__section.set(false)
	}
	function set__loaded() {
		if (link__prev__section) {
			__loaded__prev__section.set(true)
		}
		if (link__next__section) {
			__loaded__next__section.set(true)
		}
	}
</script>

<svelte:window on:scroll="{update__navigation__section}"></svelte:window>

<div class="Pagination__Scroll {class__root || ''}">
	<div class="outer-container">
		{#if prev__section}
			<a
				bind:this={link__prev__section}
				class="prev__section"
				class:loaded={$__loaded__prev__section}
				href="#{prev__section.id}"
				{color__ripple}
				on:click={__click__navigation}
			>
				<div class="prev__section__icon section__icon"></div>
				<div class="content">
					<div class="label">Previous</div>
					<div class="title">{prev__section.title}</div>
				</div>
			</a>
		{/if}
		{#if next__section}
			<a
				bind:this={link__next__section}
				class="next__section"
				class:loaded={$__loaded__next__section}
				href="#{next__section.id}"
				{color__ripple}
				on:click={__click__navigation}
			>
				<div class="next__section__icon section__icon"></div>
				<div class="content">
					<div class="label">Next</div>
					<div class="title">{next__section.title}</div>
				</div>
			</a>
		{/if}
	</div>
</div>

<style type="text/scss">
	@import "~bourbon/core/bourbon";
	$border-box-sizing: false; // fix neat & svelte warning
	@import "~@censible/core/css/variables";
	@import "~@censible/core/css/typography";
	@import "~@censible/core/css/grid-settings";
	:global(.Pagination__Scroll) {
		position: fixed;
		bottom: 0;
		right: 0;
		height: 3.6em;
		width: 100%;
		background: $teal;
		font-size: 1rem;
		font-family: $neuzeitGro-Bla;
		letter-spacing: $ls-Bla;
		color: $dark-navy;
		overflow: hidden;
		&.lower-left {
			bottom: 0;
			left: 0;
			right: auto;
		}
		@include a__typography();
		.outer-container {
			display: flex;
			flex-direction: row;
			height: 100%;
			margin: auto;
			max-width: 1200px;
			@media screen and (min-width: $tablet-min) {
				margin-left: 30px;
				margin-right: 30px;
			}
			@media screen and (min-width: $desktop-min) {
				margin: auto;
			}
			> a {
				position: relative;
				display: flex;
				flex-direction: row;
				flex: 1;
				width: 50%;
				height: 100%;
				box-sizing: border-box;
				padding-top: 14px;
				overflow: hidden;
				text-overflow: ellipsis;
				text-decoration: none;
				white-space: nowrap;
				user-select: none;
				&.prev__section {
					text-align: left;
					padding-right: 12px;
					.section__icon {
						float: left;
						margin: 9px 8px 0 3px;
						background: url(/navigation/ic_arrow_upward_black_24px.svg) no-repeat top center;
					}
				}
				&.next__section {
					flex-direction: row-reverse;
					text-align: right;
					padding-left: 12px;
					.section__icon {
						float: right;
						margin: 9px 3px 0 8px;
						background: url(/navigation/ic_arrow_downward_black_24px.svg) no-repeat top center;
					}
				}
				&.loaded {
					div {
						opacity: 1;
						transition: opacity .25s ease-out;
					}
				}
				.section__icon {
					display: flex;
					flex-direction: column;
					align-items: flex-start;
					justify-content: flex-start;
					flex: 0;
					min-width: 20px;
					max-width: 20px;
					padding-bottom: 1rem;
					background-size: contain;
				}
				.content {
					flex: 1;
					.label {
						font-size: .75em;
						font-family: $neuzeitGro-Reg;
						letter-spacing: $ls-Reg;
						line-height: 1em;
						margin-bottom: 1px;
						vertical-align: top;
					}
					.title {
						line-height: 1.25em;
						overflow: hidden;
						text-overflow: ellipsis;
						white-space: nowrap;
					}
				}
				div {
					opacity: 0;
				}
			}
		}
	}
</style>
