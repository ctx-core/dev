<script>
	import { writable } from 'svelte/store'
	import Path from './Path.html'
	import Polygon from './Polygon.html'
	import Raw from './Raw.html'
	import { get__icon } from './lib'
	import { I } from '@ctx-core/combinators'
	import { _style } from '@ctx-core/html'
	import { icons } from './lib'
	export let style = ''
	export let name = null
	export let scale = 1.0
	export let spin = false
	export let inverse = false
	export let pulse = false
	export let flip = null
	export let label = ''
	export let x = 0
	export let y = 0
	export let childrenWidth = 0
	export let childrenHeight = 0
	export let outerScale = 1
	export let width = '100%'
	export let height = '100%'
	export let viewBox = null
	let class__svg
	let normalisedScale
	let icon
	let viewBox__svg
	let width__icon
	let width__svg
	let height__icon
	let height__svg
	let style__svg
	let dom__svg
	$: {
		const arr__class = ['fa-icon']
		if (spin) {
			arr__class.push('fa-spin')
		}
		if (flip === 'horizontal') {
			arr__class.push('fa-flip-horizontal')
		} else if (flip === 'vertical') {
			arr__class.push('fa-flip-vertical')
		}
		if (inverse) {
			arr__class.push('fa-inverse')
		}
		if (pulse) {
			arr__class.push('fa-pulse')
		}
		if ($$props.class) {
			arr__class.push($$props.class)
		}
		class__svg = arr__class.join(' ')
	}
	$: {
		let numScale = 1
		if (typeof scale !== 'undefined') {
			numScale = Number(scale)
		}
		if (isNaN(numScale) || numScale <= 0) { // eslint-disable-line no-restricted-globals
			console.warn('Invalid prop: prop "scale" should be a number over 0.') // eslint-disable-line no-console
			normalisedScale = outerScale
		} else {
			normalisedScale = numScale * outerScale
		}
	}
	$: icon = name ? get__icon(name) : null
	$: width__icon = icon && icon.width
	$: height__icon = icon && icon.height
	$: width__svg = width || '100%'
	$: height__svg = height || '100%'
	$: viewBox__svg = viewBox || `0 0 ${width__icon} ${height__icon}`
	$: style__svg =
		_style(
			normalisedScale
			? { 'font-size': `${normalisedScale}em` }
			: {},
			style
		)
</script>

<svg
	bind:this={dom__svg}
	version="1.2"
	class="Icon {class__svg}"
	{label}
	width="{width__svg}"
	height="{height__svg}"
	{x}
	{y}
	viewBox="{viewBox__svg}"
	style="{I(style__svg)}"
	{spin}
	{flip}
	{inverse}
	{pulse}
	role="{ label ? 'img' : 'presentation' }"
>
  <slot>
    {#if icon}
      {#if icon.paths}
        {#each icon.paths as path, i}
      	  <Path id="{i}" data="{path}"/>
        {/each}
      {/if}
      {#if icon.polygons}
        {#each icon.polygons as polygon, i}
        	<Polygon id="{i}" data="{polygon}"/>
        {/each}
      {/if}
      {#if icon.raw}
        <Raw {icon}/>
      {/if}
    {/if}
  </slot>
</svg>
