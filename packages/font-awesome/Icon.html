<script>
	import { writable } from 'svelte/store'
	import { iife } from '@ctx-core/function'
	import Path from './Path.html'
	import Polygon from './Polygon.html'
	import Raw from './Raw.html'
	import Svg from './Svg.html'
	import { I } from '@ctx-core/combinators/lib'
	import { _style } from '@ctx-core/html'
	import { icons } from './lib'
	let class__ = $$props.class
	export let style = ''
	export let name = null
	export let scale = 1.0
	export let spin = false
	export let inverse = false
	export let pulse = false
	export let flip = null
	export let label = null
	export let x = 0
	export let y = 0
	export let childrenWidth = 0
	export let childrenHeight = 0
	export let outerScale = 1
	let normalisedScale
	let icon
	let ratio
	let width
	let height
	let box
	let style__
	let dom__icon
	$: normalisedScale = iife(() => {
		let numScale = 1
		if (typeof scale !== 'undefined') {
			numScale = Number(scale)
		}
		if (isNaN(numScale) || numScale <= 0) { // eslint-disable-line no-restricted-globals
			console.warn('Invalid prop: prop "scale" should be a number over 0.') // eslint-disable-line no-console
			return outerScale
		}
		return numScale * outerScale
	})
	$: icon = name ? icons[name] : null
	$: ratio = dom__icon ? Math.max(dom__icon.width, dom__icon.height) / 16 : 1
	$: width =
		childrenWidth
		? childrenWidth
		: dom__icon
			? (dom__icon.width / ratio) * normalisedScale
			: 0
	$: height =
		childrenHeight
		? childrenHeight
		: dom__icon
			? (dom__icon.height / ratio) * normalisedScale
			: 0
	$: box = dom__icon ? `0 0 ${dom__icon.width} ${dom__icon.height}` : `0 0 ${width} ${height}`
	$: style__ =
		_style(
			normalisedScale
			? { 'font-size': `${normalisedScale}em` }
			: {},
			style
		)
</script>

<Svg
	class="Icon {class__}"
	{label}
	{width}
	{height}
	{box}
	style="{I(style__)}"
	{spin}
	{flip}
	{inverse}
	{pulse}
	bind:this={dom__icon}
>
  <slot>
    {#if icon}
      {#if icon.paths}
        {#each icon.paths as path, i}
        <Path id="{i}" data="{path}"/>
        {/each}
      {/if}
      {#if icon.polygons}
        {#each icon.polygons as polygon, i}
        <Polygon id="{i}" data="{polygon}"/>
        {/each}
      {/if}
      {#if icon.raw}
        <Raw {icon}/>
      {/if}
    {/if}
  </slot>
</Svg>
